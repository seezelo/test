<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Naver Directions UI</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
    }

    #controls {
      padding: 10px;
      background: #fafafa;
      border-bottom: 1px solid #ddd;
    }

    #controls input {
      width: 170px;
      margin-right: 6px;
    }

    #controls button {
      padding: 4px 10px;
    }

    /* ğŸ”¥ í•µì‹¬: ì§€ë„ëŠ” ë¬´ì¡°ê±´ px */
    #map {
      width: 100%;
      height: 500px;
      background: #eee;
    }

    #info {
      padding: 10px;
      border-top: 1px solid #ddd;
      background: #fff;
    }
  </style>

  <!-- âœ… ë„¤ì´ë²„ ì§€ë„ (ncpKeyId ì‚¬ìš©) -->
  <script src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=8vgpjrgiyy"></script>
</head>

<body>

  <div id="controls">
    ì¶œë°œ:
    <input id="start" value="126.9780,37.5665" />
    ê²½ìœ :
    <input id="waypoint" value="127.0100,37.5200" />
    ë„ì°©:
    <input id="goal" value="127.0276,37.4979" />
    <button onclick="drawRoute()">ê²½ë¡œ ì°¾ê¸°</button>
  </div>

  <div id="map"></div>
  <div id="info">ê²½ë¡œë¥¼ ì…ë ¥í•˜ê³  ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”</div>

  <script>
    /***********************
     * API í‚¤
     ***********************/
    const NCP_KEY_ID = "8vgpjrgiyy"; 
    const NCP_SECRET = "R9xfzjMz2isJRQAQqv4xVWU6Rf0oyD9NQGJXjja1";

    /***********************
     * ì§€ë„ ìƒì„±
     ***********************/
    const map = new naver.maps.Map("map", {
      center: new naver.maps.LatLng(37.5665, 126.9780),
      zoom: 12
    });

    let polyline = null;
    let markers = [];

    /***********************
     * ê¸°ì¡´ ì§€ë„ ìš”ì†Œ ì œê±°
     ***********************/
    function clearMap() {
      if (polyline) {
        polyline.setMap(null);
        polyline = null;
      }
      markers.forEach(m => m.setMap(null));
      markers = [];
    }

    /***********************
     * ê²½ë¡œ ìš”ì²­ + ê·¸ë¦¬ê¸°
     ***********************/
    async function drawRoute() {
      clearMap();

      const start = document.getElementById("start").value;
      const waypoint = document.getElementById("waypoint").value;
      const goal = document.getElementById("goal").value;

      const url =
        "https://naveropenapi.apigw.ntruss.com/map-direction/v1/driving" +
        `?start=${start}` +
        `&goal=${goal}` +
        (waypoint ? `&waypoints=${waypoint}` : "") +
        `&option=trafast`;

      document.getElementById("info").innerText = "ê²½ë¡œ ê³„ì‚° ì¤‘...";

      try {
        const res = await fetch(url, {
          headers: {
            "X-NCP-APIGW-API-KEY-ID": NCP_KEY_ID,
            "X-NCP-APIGW-API-KEY": NCP_SECRET
          }
        });

        const data = await res.json();
        const route = data.route.trafast[0];

        const path = route.path.map(p =>
          new naver.maps.LatLng(p[1], p[0])
        );

        polyline = new naver.maps.Polyline({
          map,
          path,
          strokeWeight: 6,
          strokeColor: "#007AFF",
          strokeOpacity: 0.85
        });

        // ë§ˆì»¤
        const points = [start, waypoint, goal].filter(Boolean);
        points.forEach((p, idx) => {
          const [lng, lat] = p.split(",").map(Number);
          markers.push(new naver.maps.Marker({
            position: new naver.maps.LatLng(lat, lng),
            map,
            title: idx === 0 ? "ì¶œë°œ" : idx === points.length - 1 ? "ë„ì°©" : "ê²½ìœ "
          }));
        });

        // ì§€ë„ ë²”ìœ„ ìë™ ë§ì¶¤
        const bounds = new naver.maps.LatLngBounds();
        path.forEach(p => bounds.extend(p));
        map.fitBounds(bounds);

        const minutes = Math.floor(route.summary.duration / 60000);
        const distance = (route.summary.distance / 1000).toFixed(1);

        document.getElementById("info").innerHTML =
          `â± ${minutes}ë¶„ Â· ğŸ“ ${distance}km`;

      } catch (e) {
        console.error(e);
        document.getElementById("info").innerText =
          "âŒ ê²½ë¡œ ê³„ì‚° ì‹¤íŒ¨ (ì½˜ì†” í™•ì¸)";
      }
    }
  </script>
</body>
</html>
