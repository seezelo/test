<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Naver Directions UI</title>

  <style>
    body { margin:0; font-family:sans-serif; }
    #controls {
      padding:10px;
      background:#f5f5f5;
    }
    #map { width:100%; height:500px; }
  </style>

  <!-- ë„¤ì´ë²„ ì§€ë„ SDK (ncpKeyId ì‚¬ìš©) -->
  <script src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=8vgpjrgiyy"></script>
</head>

<body>
  <div id="controls">
    ğŸŸ¢ ì¶œë°œ â†’ ğŸ”µ ê²½ìœ  â†’ ğŸ”´ ë„ì°© ìˆœì„œë¡œ ì§€ë„ í´ë¦­  
    <button onclick="findRoute()">ê²½ë¡œ ì°¾ê¸°</button>
    <span id="info"></span>
  </div>

  <div id="map"></div>

  <script>
    let map, markers = [], polyline;
    let points = [];

    map = new naver.maps.Map("map", {
      center: new naver.maps.LatLng(37.5665, 126.9780),
      zoom: 12
    });

    // ì§€ë„ í´ë¦­ â†’ ë§ˆì»¤ ì¶”ê°€
    naver.maps.Event.addListener(map, "click", e => {
      if (points.length >= 3) return alert("ìµœëŒ€ 3ê°œ (ì¶œë°œ/ê²½ìœ /ë„ì°©)");

      const latlng = e.coord;
      points.push(`${latlng.lng()},${latlng.lat()}`);

      const colors = ["green", "blue", "red"];
      const marker = new naver.maps.Marker({
        position: latlng,
        map,
        icon: {
          content: `<div style="width:14px;height:14px;
            background:${colors[points.length-1]};
            border-radius:50%"></div>`
        }
      });

      markers.push(marker);
    });

    async function findRoute() {
      if (points.length < 2) {
        alert("ì¶œë°œ/ë„ì°© í•„ìš”");
        return;
      }

      const start = points[0];
      const goal = points[points.length - 1];
      const waypoints =
        points.length === 3 ? points[1] : "";

      const res = await fetch(
        `/api/directions?start=${start}&goal=${goal}&waypoints=${waypoints}`
      );

      const data = await res.json();
      const route = data.route.trafast[0];

      // ê²½ë¡œ ì„  ì œê±°
      if (polyline) polyline.setMap(null);

      const path = route.path.map(p =>
        new naver.maps.LatLng(p[1], p[0])
      );

      polyline = new naver.maps.Polyline({
        map,
        path,
        strokeColor: "#007AFF",
        strokeWeight: 6
      });

      const min = Math.floor(route.summary.duration / 60000);
      document.getElementById("info").innerText =
        ` â± ${min}ë¶„`;
    }
  </script>
</body>
</html>
