<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Naver Directions Marker UI</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
    }

    #controls {
      padding: 10px;
      background: #fafafa;
      border-bottom: 1px solid #ddd;
    }

    #controls button {
      padding: 6px 12px;
      margin-right: 6px;
    }

    #map {
      width: 100%;
      height: 500px; /* ğŸ”¥ ì ˆëŒ€ í•„ìˆ˜ */
      background: #eee;
    }

    #info {
      padding: 10px;
      border-top: 1px solid #ddd;
    }
  </style>

  <!-- âœ… ë„¤ì´ë²„ ì§€ë„ -->
  <script src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=8vgpjrgiyy"></script>
</head>

<body>

  <div id="controls">
    <button onclick="resetAll()">ì´ˆê¸°í™”</button>
    <span id="status">ì§€ë„ì—ì„œ ì¶œë°œ ìœ„ì¹˜ë¥¼ í´ë¦­í•˜ì„¸ìš”</span>
  </div>

  <div id="map"></div>
  <div id="info">ê²½ë¡œ ì •ë³´</div>

  <script>
    /***********************
     * API í‚¤
     ***********************/
    const NCP_KEY_ID = "8vgpjrgiyy";
    const NCP_SECRET = "R9xfzjMz2isJRQAQqv4xVWU6Rf0oyD9NQGJXjja1";

    /***********************
     * ì§€ë„ ìƒì„±
     ***********************/
    const map = new naver.maps.Map("map", {
      center: new naver.maps.LatLng(37.5665, 126.9780),
      zoom: 12
    });

    let markers = [];
    let polyline = null;
    let points = []; // í´ë¦­í•œ ì¢Œí‘œ (lng,lat)

    const statusEl = document.getElementById("status");
    const infoEl = document.getElementById("info");

    /***********************
     * ì§€ë„ í´ë¦­ ì´ë²¤íŠ¸
     ***********************/
    naver.maps.Event.addListener(map, "click", e => {
      if (points.length >= 3) return;

      const lat = e.coord.lat();
      const lng = e.coord.lng();

      points.push(`${lng},${lat}`);

      const marker = new naver.maps.Marker({
        position: new naver.maps.LatLng(lat, lng),
        map,
        title:
          points.length === 1 ? "ì¶œë°œ" :
          points.length === 2 ? "ê²½ìœ " : "ë„ì°©"
      });

      markers.push(marker);

      if (points.length === 1)
        statusEl.innerText = "ê²½ìœ  ìœ„ì¹˜ë¥¼ í´ë¦­í•˜ì„¸ìš”";
      else if (points.length === 2)
        statusEl.innerText = "ë„ì°© ìœ„ì¹˜ë¥¼ í´ë¦­í•˜ì„¸ìš”";
      else {
        statusEl.innerText = "ê²½ë¡œ ê³„ì‚° ì¤‘...";
        drawRoute();
      }
    });

    /***********************
     * ê²½ë¡œ ìš”ì²­
     ***********************/
    async function drawRoute() {
      const start = points[0];
      const goal = points[2];
      const waypoint = points[1];

      const url =
        "https://naveropenapi.apigw.ntruss.com/map-direction/v1/driving" +
        `?start=${start}` +
        `&goal=${goal}` +
        `&waypoints=${waypoint}` +
        `&option=trafast`;

      try {
        const res = await fetch(url, {
          headers: {
            "X-NCP-APIGW-API-KEY-ID": NCP_KEY_ID,
            "X-NCP-APIGW-API-KEY": NCP_SECRET
          }
        });

        const data = await res.json();
        const route = data.route.trafast[0];

        const path = route.path.map(p =>
          new naver.maps.LatLng(p[1], p[0])
        );

        polyline = new naver.maps.Polyline({
          map,
          path,
          strokeWeight: 6,
          strokeColor: "#007AFF",
          strokeOpacity: 0.85
        });

        const bounds = new naver.maps.LatLngBounds();
        path.forEach(p => bounds.extend(p));
        map.fitBounds(bounds);

        const minutes = Math.floor(route.summary.duration / 60000);
        const distance = (route.summary.distance / 1000).toFixed(1);

        infoEl.innerHTML =
          `â± ${minutes}ë¶„ Â· ğŸ“ ${distance}km`;

      } catch (e) {
        console.error(e);
        infoEl.innerText = "âŒ ê²½ë¡œ ê³„ì‚° ì‹¤íŒ¨";
      }
    }

    /***********************
     * ì´ˆê¸°í™”
     ***********************/
    function resetAll() {
      markers.forEach(m => m.setMap(null));
      markers = [];
      points = [];

      if (polyline) {
        polyline.setMap(null);
        polyline = null;
      }

      statusEl.innerText = "ì§€ë„ì—ì„œ ì¶œë°œ ìœ„ì¹˜ë¥¼ í´ë¦­í•˜ì„¸ìš”";
      infoEl.innerText = "ê²½ë¡œ ì •ë³´";
    }
  </script>

</body>
</html>
